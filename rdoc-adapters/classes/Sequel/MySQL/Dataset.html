<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>Sequel::MySQL::Dataset</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>class</span>
          Sequel::MySQL::Dataset
        </h1>
        <ol class='paths'>
          <li>
            <a target="docwin" href="../../../files/lib/sequel/adapters/mysql_rb.html">lib/sequel/adapters/mysql.rb</a>
          </li>
        </ol>
        <div class='parent'>
          Parent:
          <strong><a target="docwin" href="../MySQL.html">MySQL</a></strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            
            <p><a href="Dataset.html">Dataset</a> class for <a
            href="../MySQL.html">MySQL</a> datasets accessed via the native driver.</p>
          </div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>Public Instance</h3>
            <ol>
              <li><a target="docwin" href="#method-i-fetch_rows">fetch_rows</a></li>
              <li><a target="docwin" href="#method-i-graph">graph</a></li>
              <li><a target="docwin" href="#method-i-split_multiple_result_sets">split_multiple_result_sets</a></li>
            </ol>
          </div>
          <div id='context'>
            <div id='includes'>
              <h2>Included modules</h2>
              <ol>
                <li><a target="docwin" href="DatasetMethods.html">Sequel::MySQL::DatasetMethods</a></li>
                <li><a target="docwin" href="PreparedStatements/DatasetMethods.html">Sequel::MySQL::PreparedStatements::DatasetMethods</a></li>
              </ol>
            </div>
          </div>
          <div id='section'>
            <div id='constants-list'>
              <h2>Constants</h2>
              <div class='name-list'>
                <table summary='Constants'>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>DatasetClass</td>
                    <td>=</td>
                    <td class='context-item-value'>self</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='methods'>
              <h2>Public Instance methods</h2>
              <div class='method public-instance' id='method-method-i-fetch_rows'>
                <a name='method-i-fetch_rows'></a>
                <div class='synopsis'>
                  <span class='name'>fetch_rows</span>
                  <span class='arguments'>(sql)</span>
                </div>
                <div class='description'>
                  
                  <p>Yield all rows matching this dataset.  If the dataset is set to split
                  multiple statements, yield arrays of hashes one per statement instead of
                  yielding results for all statements as hashes.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-fetch_rows-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-fetch_rows-source'><span class="ruby-comment"># File lib/sequel/adapters/mysql.rb, line 295</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">fetch_rows</span>(<span class="ruby-identifier">sql</span>)&#x000A;  <span class="ruby-identifier">execute</span>(<span class="ruby-identifier">sql</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>&#x000A;    <span class="ruby-identifier">i</span> = <span class="ruby-value">-1</span>&#x000A;    <span class="ruby-identifier">cps</span> = <span class="ruby-identifier">db</span>.<span class="ruby-identifier">conversion_procs</span>&#x000A;    <span class="ruby-identifier">cols</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">fetch_fields</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> &#x000A;      <span class="ruby-comment"># Pretend tinyint is another integer type if its length is not 1, to</span>&#x000A;      <span class="ruby-comment"># avoid casting to boolean if Sequel::MySQL.convert_tinyint_to_bool</span>&#x000A;      <span class="ruby-comment"># is set.</span>&#x000A;      <span class="ruby-identifier">type_proc</span> = <span class="ruby-identifier">f</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cast_tinyint_integer?</span>(<span class="ruby-identifier">f</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">cps</span>[<span class="ruby-value">2</span>] <span class="ruby-operator">:</span> <span class="ruby-identifier">cps</span>[<span class="ruby-identifier">f</span>.<span class="ruby-identifier">type</span>]&#x000A;      [<span class="ruby-identifier">output_identifier</span>(<span class="ruby-identifier">f</span>.<span class="ruby-identifier">name</span>), <span class="ruby-identifier">type_proc</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">+=</span><span class="ruby-value">1</span>]&#x000A;    <span class="ruby-keyword">end</span>&#x000A;    <span class="ruby-ivar">@columns</span> = <span class="ruby-identifier">cols</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">first</span>}&#x000A;    <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:split_multiple_result_sets</span>]&#x000A;      <span class="ruby-identifier">s</span> = []&#x000A;      <span class="ruby-identifier">yield_rows</span>(<span class="ruby-identifier">r</span>, <span class="ruby-identifier">cols</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">h</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">h</span>}&#x000A;      <span class="ruby-keyword">yield</span> <span class="ruby-identifier">s</span>&#x000A;    <span class="ruby-keyword">else</span>&#x000A;      <span class="ruby-identifier">yield_rows</span>(<span class="ruby-identifier">r</span>, <span class="ruby-identifier">cols</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">h</span><span class="ruby-operator">|</span> <span class="ruby-keyword">yield</span> <span class="ruby-identifier">h</span>}&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">self</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-graph'>
                <a name='method-i-graph'></a>
                <div class='synopsis'>
                  <span class='name'>graph</span>
                  <span class='arguments'>(*)</span>
                </div>
                <div class='description'>
                  
                  <p>Donâ€™t allow graphing a dataset that splits multiple statements</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-graph-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-graph-source'><span class="ruby-comment"># File lib/sequel/adapters/mysql.rb, line 319</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">graph</span>(*)&#x000A;  <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Error</span>, <span class="ruby-string">&quot;Can't graph a dataset that splits multiple result sets&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:split_multiple_result_sets</span>]&#x000A;  <span class="ruby-keyword">super</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-split_multiple_result_sets'>
                <a name='method-i-split_multiple_result_sets'></a>
                <div class='synopsis'>
                  <span class='name'>split_multiple_result_sets</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>Makes each yield arrays of rows, with each array containing the rows for a
                  given result set.  Does not work with graphing.  So you can submit SQL with
                  multiple statements and easily determine which statement returned which
                  results.</p>
                  
                  <p>Modifies the row_proc of the returned dataset so that it still works as
                  expected (running on the hashes instead of on the arrays of hashes). If you
                  modify the row_proc afterward, note that it will receive an array of hashes
                  instead of a hash.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-split_multiple_result_sets-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-split_multiple_result_sets-source'><span class="ruby-comment"># File lib/sequel/adapters/mysql.rb, line 333</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">split_multiple_result_sets</span>&#x000A;  <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Error</span>, <span class="ruby-string">&quot;Can't split multiple statements on a graphed dataset&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:graph</span>]&#x000A;  <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">clone</span>(<span class="ruby-value">:split_multiple_result_sets=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">true</span>)&#x000A;  <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">row_proc</span> = <span class="ruby-identifier">proc</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">h</span><span class="ruby-operator">|</span> <span class="ruby-identifier">row_proc</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">h</span>)}} <span class="ruby-keyword">if</span> <span class="ruby-identifier">row_proc</span>&#x000A;  <span class="ruby-identifier">ds</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a target="docwin" href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
