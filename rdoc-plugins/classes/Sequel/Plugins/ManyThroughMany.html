<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>Sequel::Plugins::ManyThroughMany</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>module</span>
          Sequel::Plugins::ManyThroughMany
        </h1>
        <ol class='paths'>
          <li>
            <a target="docwin" href="../../../files/lib/sequel/plugins/many_through_many_rb.html">lib/sequel/plugins/many_through_many.rb</a>
          </li>
        </ol>
        <div class='parent'>
          Parent:
          <strong><a target="docwin" href="../Plugins.html">Plugins</a></strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            
            <p>The many_through_many plugin allow you to create an association to multiple
            objects using multiple join tables. For example, assume the following
            associations:</p>
            
            <pre>Artist.many_to_many :albums&#x000A;Album.many_to_many :tags</pre>
            
            <p>The many_through_many plugin would allow this:</p>
            
            <pre>Artist.plugin :many_through_many&#x000A;Artist.many_through_many :tags, [[:albums_artists, :artist_id, :album_id], [:albums, :id, :id], [:albums_tags, :album_id, :tag_id]]</pre>
            
            <p>Which will give you the tags for all of the artist’s albums.</p>
            
            <p>Let’s break down the 2nd argument of the many_through_many call:</p>
            
            <pre>[[:albums_artists, :artist_id, :album_id],&#x000A; [:albums, :id, :id],&#x000A; [:albums_tags, :album_id, :tag_id]]</pre>
            
            <p>This argument is an array of arrays with three elements.  Each entry in the
            main array represents a JOIN in SQL:</p>
            <ul><li>
            <p>The first element in each array represents the name of the table to join.</p>
            </li><li>
            <p>The second element in each array represents the column used to join to the
            previous table.</p>
            </li><li>
            <p>The third element in each array represents the column used to join to the
            next table.</p>
            </li></ul>
            
            <p>So the “Artist.many_through_many :tags” is translated into something
            similar to:</p>
            
            <pre>FROM artists&#x000A;JOIN albums_artists ON (artists.id = albums_artists.artist_id)&#x000A;JOIN albums ON (albums_artists.album_id = albums.id)&#x000A;JOIN albums_tags ON (albums.id = albums_tag.album_id)&#x000A;JOIN tags ON (albums_tags.tag_id = tags.id)</pre>
            
            <p>The “artists.id” and “tags.id” criteria come from other association options
            (defaulting to the primary keys of the current and associated tables), but
            hopefully you can see how each argument in the array is used in the JOIN
            clauses.</p>
            
            <p>Here are some more examples:</p>
            
            <pre class="ruby"><span class="ruby-comment"># Same as Artist.many_to_many :albums</span>&#x000A;<span class="ruby-constant">Artist</span>.<span class="ruby-identifier">many_through_many</span> :<span class="ruby-identifier">albums</span>, [[:<span class="ruby-identifier">albums_artists</span>, :<span class="ruby-identifier">artist_id</span>, :<span class="ruby-identifier">album_id</span>]]&#x000A;&#x000A;<span class="ruby-comment"># All artists that are associated to any album that this artist is associated to</span>&#x000A;<span class="ruby-constant">Artist</span>.<span class="ruby-identifier">many_through_many</span> :<span class="ruby-identifier">artists</span>, [[:<span class="ruby-identifier">albums_artists</span>, :<span class="ruby-identifier">artist_id</span>, :<span class="ruby-identifier">album_id</span>], [:<span class="ruby-identifier">albums</span>, :<span class="ruby-identifier">id</span>, :<span class="ruby-identifier">id</span>], [:<span class="ruby-identifier">albums_artists</span>, :<span class="ruby-identifier">album_id</span>, :<span class="ruby-identifier">artist_id</span>]]&#x000A;&#x000A;<span class="ruby-comment"># All albums by artists that are associated to any album that this artist is associated to</span>&#x000A;<span class="ruby-constant">Artist</span>.<span class="ruby-identifier">many_through_many</span> :<span class="ruby-identifier">artist_albums</span>, [[:<span class="ruby-identifier">albums_artists</span>, :<span class="ruby-identifier">artist_id</span>, :<span class="ruby-identifier">album_id</span>], [:<span class="ruby-identifier">albums</span>, :<span class="ruby-identifier">id</span>, :<span class="ruby-identifier">id</span>],   [:<span class="ruby-identifier">albums_artists</span>, :<span class="ruby-identifier">album_id</span>, :<span class="ruby-identifier">artist_id</span>], [:<span class="ruby-identifier">artists</span>, :<span class="ruby-identifier">id</span>, :<span class="ruby-identifier">id</span>], [:<span class="ruby-identifier">albums_artists</span>, :<span class="ruby-identifier">artist_id</span>, :<span class="ruby-identifier">album_id</span>]],   :<span class="ruby-keyword">class</span>=<span class="ruby-operator">&gt;</span>:<span class="ruby-constant">Album</span>&#x000A;&#x000A;<span class="ruby-comment"># All tracks on albums by this artist</span>&#x000A;<span class="ruby-constant">Artist</span>.<span class="ruby-identifier">many_through_many</span> :<span class="ruby-identifier">tracks</span>, [[:<span class="ruby-identifier">albums_artists</span>, :<span class="ruby-identifier">artist_id</span>, :<span class="ruby-identifier">album_id</span>], [:<span class="ruby-identifier">albums</span>, :<span class="ruby-identifier">id</span>, :<span class="ruby-identifier">id</span>]],   :<span class="ruby-identifier">right_primary_key=</span><span class="ruby-operator">&gt;</span>:<span class="ruby-identifier">album_id</span></pre>
            
            <p>Often you don’t want the current object to appear in the array of
            associated objects.  This is easiest to handle via an :after_load hook:</p>
            
            <pre class="ruby"><span class="ruby-constant">Artist</span>.<span class="ruby-identifier">many_through_many</span> :<span class="ruby-identifier">artists</span>, [[:<span class="ruby-identifier">albums_artists</span>, :<span class="ruby-identifier">artist_id</span>, :<span class="ruby-identifier">album_id</span>], [:<span class="ruby-identifier">albums</span>, :<span class="ruby-identifier">id</span>, :<span class="ruby-identifier">id</span>], [:<span class="ruby-identifier">albums_artists</span>, :<span class="ruby-identifier">album_id</span>, :<span class="ruby-identifier">artist_id</span>]],&#x000A;  :<span class="ruby-identifier">after_load=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">proc</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">artist</span>, <span class="ruby-identifier">associated_artists</span><span class="ruby-operator">|</span> <span class="ruby-identifier">associated_artists</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">artist</span>)}</pre>
            
            <p>You can also handle it by adding a dataset block that excludes the current
            record (so it won’t be retrieved at all), but that won’t work when eagerly
            loading, which is why the :after_load proc is recommended instead.</p>
            
            <p>It’s also common to not want duplicate records, in which case the :distinct
            option can be used:</p>
            
            <pre class="ruby"><span class="ruby-constant">Artist</span>.<span class="ruby-identifier">many_through_many</span> :<span class="ruby-identifier">artists</span>, [[:<span class="ruby-identifier">albums_artists</span>, :<span class="ruby-identifier">artist_id</span>, :<span class="ruby-identifier">album_id</span>], [:<span class="ruby-identifier">albums</span>, :<span class="ruby-identifier">id</span>, :<span class="ruby-identifier">id</span>], [:<span class="ruby-identifier">albums_artists</span>, :<span class="ruby-identifier">album_id</span>, :<span class="ruby-identifier">artist_id</span>]],&#x000A; :<span class="ruby-identifier">distinct=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">true</span></pre>
          </div>
          <div id='context'>
          </div>
          <div id='class-list'>
            <h2>Classes and Modules</h2>
            <ol>
              <li><a target="docwin" href="ManyThroughMany/ClassMethods.html">Sequel::Plugins::ManyThroughMany::ClassMethods</a></li>
              <li><a target="docwin" href="ManyThroughMany/DatasetMethods.html">Sequel::Plugins::ManyThroughMany::DatasetMethods</a></li>
              <li><a target="docwin" href="ManyThroughMany/ManyThroughManyAssociationReflection.html">Sequel::Plugins::ManyThroughMany::ManyThroughManyAssociationReflection</a></li>
            </ol>
          </div>
          <div id='section'>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a target="docwin" href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
