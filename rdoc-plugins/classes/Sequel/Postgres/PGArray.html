<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>Sequel::Postgres::PGArray</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>class</span>
          Sequel::Postgres::PGArray
        </h1>
        <ol class='paths'>
          <li>
            <a target="docwin" href="../../../files/lib/sequel/extensions/pg_array_rb.html">lib/sequel/extensions/pg_array.rb</a>
          </li>
          <li class='other'>
            <a target="docwin" href="../../../files/lib/sequel/extensions/pg_array_ops_rb.html">lib/sequel/extensions/pg_array_ops.rb</a>
          </li>
          <li>
            <a class='show' href='#' onclick='this.parentNode.parentNode.className += " expanded"; this.parentNode.removeChild(this); return false'>show all</a>
          </li>
        </ol>
        <div class='parent'>
          Parent:
          <strong><a target="docwin" href="../Postgres.html">Postgres</a></strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            
            <p>Represents a PostgreSQL array column value.</p>
          </div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>Public Class</h3>
            <ol>
              <li><a target="docwin" href="#method-c-new">new</a></li>
              <li><a target="docwin" href="#method-c-register">register</a></li>
            </ol>
            <h3>Public Instance</h3>
            <ol>
              <li><a target="docwin" href="#attribute-i-array_type">array_type</a></li>
              <li><a target="docwin" href="#method-i-op">op</a></li>
              <li><a target="docwin" href="#method-i-sql_literal_append">sql_literal_append</a></li>
            </ol>
          </div>
          <div id='context'>
            <div id='includes'>
              <h2>Included modules</h2>
              <ol>
                <li>Sequel::SQL::AliasMethods</li>
              </ol>
            </div>
          </div>
          <div id='class-list'>
            <h2>Classes and Modules</h2>
            <ol>
              <li><a target="docwin" href="PGArray/DatabaseMethods.html">Sequel::Postgres::PGArray::DatabaseMethods</a></li>
              <li><a target="docwin" href="PGArray/Creator.html">Sequel::Postgres::PGArray::Creator</a></li>
              <li><a target="docwin" href="PGArray/JSONCreator.html">Sequel::Postgres::PGArray::JSONCreator</a></li>
              <li><a target="docwin" href="PGArray/Parser.html">Sequel::Postgres::PGArray::Parser</a></li>
            </ol>
          </div>
          <div id='section'>
            <div id='constants-list'>
              <h2>Constants</h2>
              <div class='name-list'>
                <table summary='Constants'>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>ARRAY</td>
                    <td>=</td>
                    <td class='context-item-value'>"ARRAY".freeze</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>ARRAY_TYPES</td>
                    <td>=</td>
                    <td class='context-item-value'>{}</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'>
                      
                      <p>Global hash of database array type name strings to symbols (e.g. ‘double
                      precision’ =&gt; :float), used by the schema parsing for array types
                      registered globally.</p>
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>BACKSLASH</td>
                    <td>=</td>
                    <td class='context-item-value'>'\\'.freeze</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>CLOSE_BRACE</td>
                    <td>=</td>
                    <td class='context-item-value'>'}'.freeze</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>CLOSE_BRACKET</td>
                    <td>=</td>
                    <td class='context-item-value'>']'.freeze</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>COMMA</td>
                    <td>=</td>
                    <td class='context-item-value'>','.freeze</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>DOUBLE_COLON</td>
                    <td>=</td>
                    <td class='context-item-value'>'::'.freeze</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>EMPTY_ARRAY</td>
                    <td>=</td>
                    <td class='context-item-value'>"'{}'".freeze</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>EMPTY_BRACKET</td>
                    <td>=</td>
                    <td class='context-item-value'>'[]'.freeze</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>EMPTY_STRING</td>
                    <td>=</td>
                    <td class='context-item-value'>''.freeze</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>NULL</td>
                    <td>=</td>
                    <td class='context-item-value'>'NULL'.freeze</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>OPEN_BRACE</td>
                    <td>=</td>
                    <td class='context-item-value'>'{'.freeze</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>OPEN_BRACKET</td>
                    <td>=</td>
                    <td class='context-item-value'>'['.freeze</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>QUOTE</td>
                    <td>=</td>
                    <td class='context-item-value'>'"'.freeze</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='attribute-list'>
              <h2 class='section-bar'>Attributes</h2>
              <div class='name-list'>
                <table>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>
                      <a name='attribute-i-array_type'>array_type</a>
                    </td>
                    <td class='context-item-value'>[RW]</td>
                    <td class='context-item-desc'>
                      
                      <p>The type of this array.  May be nil if no type was given. If a type is
                      provided, the array is automatically casted to this type when literalizing.
                      This type is the underlying type, not the array type itself, so for an
                      int4[] database type, it should be :int4 or ‘int4’</p>
                    </td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='methods'>
              <h2>Public Class methods</h2>
              <div class='method public-class' id='method-method-c-new'>
                <a name='method-c-new'></a>
                <div class='synopsis'>
                  <span class='name'>new</span>
                  <span class='arguments'>(array, type=nil)</span>
                </div>
                <div class='description'>
                  
                  <p>Set the array to delegate to, and a database type.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-c-new-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-c-new-source'><span class="ruby-comment"># File lib/sequel/extensions/pg_array.rb, line 513</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">array</span>, <span class="ruby-identifier">type</span>=<span class="ruby-keyword">nil</span>)&#x000A;  <span class="ruby-keyword">super</span>(<span class="ruby-identifier">array</span>)&#x000A;  <span class="ruby-ivar">@array_type</span> = <span class="ruby-identifier">type</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-class' id='method-method-c-register'>
                <a name='method-c-register'></a>
                <div class='synopsis'>
                  <span class='name'>register</span>
                  <span class='arguments'>(db_type, opts=OPTS, &block)</span>
                </div>
                <div class='description'>
                  
                  <p>Registers an array type that the extension should handle.  Makes a <a
                  href="../Database.html">Database</a> instance that has been extended with
                  <a href="PGArray/DatabaseMethods.html">DatabaseMethods</a> recognize the
                  array type given and set up the appropriate typecasting.  Also sets up
                  automatic typecasting for the native postgres adapter, so that on
                  retrieval, the values are automatically converted to <a
                  href="PGArray.html">PGArray</a> instances. The db_type argument should be
                  the exact database type used (as returned by the PostgreSQL format_type
                  database function).  Accepts the following options:</p>
                  <dl class="rdoc-list note-list"><dt>:<a href="PGArray.html#attribute-i-array_type">#array_type</a> 
                  <dd>
                  <p>The type to automatically cast the array to when literalizing the array.
                  Usually the same as db_type.</p>
                  </dd><dt>:converter 
                  <dd>
                  <p>A callable object (e.g. Proc), that is called with each element of the
                  array (usually a string), and should return the appropriate typecasted
                  object.</p>
                  </dd><dt>:oid 
                  <dd>
                  <p>The PostgreSQL OID for the array type.  This is used by the <a
                  href="../../Sequel.html">Sequel</a> postgres adapter to set up automatic
                  type conversion on retrieval from the database.</p>
                  </dd><dt>:parser 
                  <dd>
                  <p>Can be set to :json to use the faster JSON-based parser.  Note that the
                  JSON-based parser can only correctly handle integers values correctly.  It
                  doesn’t handle full precision for numeric types, and doesn’t handle
                  NaN/Infinity values for floating point types.</p>
                  </dd><dt>:scalar_oid 
                  <dd>
                  <p>Should be the PostgreSQL OID for the scalar version of this array type. If
                  given, automatically sets the :converter option by looking for scalar
                  conversion proc.</p>
                  </dd><dt>:scalar_typecast 
                  <dd>
                  <p>Should be a symbol indicating the typecast method that should be called on
                  each element of the array, when a plain array is passed into a database
                  typecast method.  For example, for an array of integers, this could be set
                  to :integer, so that the typecast_value_integer method is called on all of
                  the array elements.  Defaults to :type_symbol option.</p>
                  </dd><dt>:type_procs 
                  <dd>
                  <p>A hash mapping oids to conversion procs, used for looking up the
                  :scalar_oid and value and setting the :oid value.  Defaults to the global
                  Sequel::Postgres::PG_TYPES.</p>
                  </dd><dt>:type_symbol 
                  <dd>
                  <p>The base of the schema type symbol for this type.  For example, if you
                  provide :integer, <a href="../../Sequel.html">Sequel</a> will recognize
                  this type as :integer_array during schema parsing. Defaults to the db_type
                  argument.</p>
                  </dd><dt>:typecast_method 
                  <dd>
                  <p>If given, specifies the :type_symbol option, but additionally causes no
                  typecasting method to be created in the database.  This should only be used
                  to alias existing array types.  For example, if there is an array type that
                  can be treated just like an integer array, you can do
                  :typecast_method=&gt;:integer.</p>
                  </dd><dt>:typecast_method_map 
                  <dd>
                  <p>The map in which to place the database type string to type symbol mapping.
                  Defaults to <a href="PGArray.html#ARRAY_TYPES">ARRAY_TYPES</a>.</p>
                  </dd><dt>:typecast_methods_module 
                  <dd>
                  <p>If given, a module object to add the typecasting method to.  Defaults to <a
                  href="PGArray/DatabaseMethods.html">DatabaseMethods</a>.</p>
                  </dd></dl>
                  
                  <p>If a block is given, it is treated as the :converter option.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-c-register-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-c-register-source'><span class="ruby-comment"># File lib/sequel/extensions/pg_array.rb, line 169</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">register</span>(<span class="ruby-identifier">db_type</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>, &amp;<span class="ruby-identifier">block</span>)&#x000A;  <span class="ruby-identifier">db_type</span> = <span class="ruby-identifier">db_type</span>.<span class="ruby-identifier">to_s</span>&#x000A;  <span class="ruby-identifier">typecast_method</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:typecast_method</span>]&#x000A;  <span class="ruby-identifier">type</span> = (<span class="ruby-identifier">typecast_method</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:type_symbol</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">db_type</span>).<span class="ruby-identifier">to_sym</span>&#x000A;  <span class="ruby-identifier">type_procs</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:type_procs</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">PG_TYPES</span>&#x000A;  <span class="ruby-identifier">mod</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:typecast_methods_module</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">DatabaseMethods</span>&#x000A;  <span class="ruby-identifier">typecast_method_map</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:typecast_method_map</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">ARRAY_TYPES</span>&#x000A;&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">converter</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:converter</span>]&#x000A;    <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-string">&quot;can't provide both a block and :converter option to register&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span>&#x000A;  <span class="ruby-keyword">else</span>&#x000A;    <span class="ruby-identifier">converter</span> = <span class="ruby-identifier">block</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">soid</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:scalar_oid</span>]&#x000A;    <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-string">&quot;can't provide both a converter and :scalar_oid option to register&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">converter</span> &#x000A;    <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;no conversion proc for :scalar_oid=&gt;#{soid.inspect}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">converter</span> = <span class="ruby-identifier">type_procs</span>[<span class="ruby-identifier">soid</span>]&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-identifier">array_type</span> = (<span class="ruby-identifier">opts</span>[<span class="ruby-value">:array_type</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">db_type</span>).<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">freeze</span>&#x000A;  <span class="ruby-identifier">creator</span> = (<span class="ruby-identifier">opts</span>[<span class="ruby-value">:parser</span>] <span class="ruby-operator">==</span> <span class="ruby-value">:json</span> <span class="ruby-operator">?</span> <span class="ruby-constant">JSONCreator</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Creator</span>).<span class="ruby-identifier">new</span>(<span class="ruby-identifier">array_type</span>, <span class="ruby-identifier">converter</span>)&#x000A;&#x000A;  <span class="ruby-identifier">typecast_method_map</span>[<span class="ruby-identifier">db_type</span>] = <span class="ruby-value">:&quot;#{type}_array&quot;</span>&#x000A;&#x000A;  <span class="ruby-identifier">define_array_typecast_method</span>(<span class="ruby-identifier">mod</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">creator</span>, <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:scalar_typecast</span>, <span class="ruby-identifier">type</span>)) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">typecast_method</span>&#x000A;&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">oid</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:oid</span>]&#x000A;    <span class="ruby-identifier">type_procs</span>[<span class="ruby-identifier">oid</span>] = <span class="ruby-identifier">creator</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-keyword">nil</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <h2>Public Instance methods</h2>
              <div class='method public-instance' id='method-method-i-op'>
                <a name='method-i-op'></a>
                <div class='synopsis'>
                  <span class='name'>op</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>Wrap the <a href="PGArray.html">PGArray</a> instance in an <a
                  href="ArrayOp.html">ArrayOp</a>, allowing you to easily use the PostgreSQL
                  array functions and operators with literal arrays.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-op-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-op-source'><span class="ruby-comment"># File lib/sequel/extensions/pg_array_ops.rb, line 266</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">op</span>&#x000A;  <span class="ruby-constant">ArrayOp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-sql_literal_append'>
                <a name='method-i-sql_literal_append'></a>
                <div class='synopsis'>
                  <span class='name'>sql_literal_append</span>
                  <span class='arguments'>(ds, sql)</span>
                </div>
                <div class='description'>
                  
                  <p>Append the array <a href="../SQL.html">SQL</a> to the given sql string.  If
                  the receiver has a type, add a cast to the database array type.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-sql_literal_append-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-sql_literal_append-source'><span class="ruby-comment"># File lib/sequel/extensions/pg_array.rb, line 521</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">sql_literal_append</span>(<span class="ruby-identifier">ds</span>, <span class="ruby-identifier">sql</span>)&#x000A;  <span class="ruby-identifier">at</span> = <span class="ruby-identifier">array_type</span>&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">at</span>&#x000A;    <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">EMPTY_ARRAY</span>&#x000A;  <span class="ruby-keyword">else</span>&#x000A;    <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">ARRAY</span>&#x000A;    <span class="ruby-identifier">_literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">ds</span>, <span class="ruby-identifier">to_a</span>)&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">at</span>&#x000A;    <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">DOUBLE_COLON</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">at</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">EMPTY_BRACKET</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a target="docwin" href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
