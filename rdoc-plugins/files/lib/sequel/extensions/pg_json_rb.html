<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>pg_json.rb</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='file' id='wrapper'>
      <div class='header'>
        <h1 class='name'>pg_json.rb</h1>
        <div class='paths'>
          lib/sequel/extensions/pg_json.rb
        </div>
        <div class='last-update'>
          Last Update:
          <span class='datetime'>2013-11-08 08:08:17 -0500</span>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            
            <p>The pg_json extension adds support for <a
            href="../../../../classes/Sequel.html">Sequel</a> to handle PostgreSQL’s
            json type.  It is slightly more strict than the PostgreSQL json type in
            that the object returned must be an array or object (PostgreSQL’s json type
            considers plain numbers and strings as valid).  This is because <a
            href="../../../../classes/Sequel.html">Sequel</a> relies completely on the
            ruby JSON library for parsing, and ruby’s JSON library does not accept the
            values.</p>
            
            <p>This extension integrates with Sequel’s native postgres adapter, so that
            when json fields are retrieved, they are parsed and returned as instances
            of <a
            href="../../../../classes/Sequel/Postgres/JSONArray.html">Sequel::Postgres::JSONArray</a>
            or <a
            href="../../../../classes/Sequel/Postgres/JSONHash.html">Sequel::Postgres::JSONHash</a>.
            JSONArray and JSONHash are DelegateClasses of <a
            href="../../../../classes/Array.html">Array</a> and <a
            href="../../../../classes/Hash.html">Hash</a>, so they mostly act the same,
            but not completely (json_array.is_a?(<a
            href="../../../../classes/Array.html">Array</a>) is false).  If you want
            the actual array for a JSONArray, call JSONArray#to_a.  If you want the
            actual hash for a JSONHash, call JSONHash#to_hash. This is done so that <a
            href="../../../../classes/Sequel.html">Sequel</a> does not treat JSONArray
            and JSONHash like <a href="../../../../classes/Array.html">Array</a> and <a
            href="../../../../classes/Hash.html">Hash</a> by default, which would cause
            issues.</p>
            
            <p>To turn an existing <a href="../../../../classes/Array.html">Array</a> or
            <a href="../../../../classes/Hash.html">Hash</a> into a JSONArray or
            JSONHash, use Sequel.pg_json:</p>
            
            <pre>Sequel.pg_json(array)&#x000A;Sequel.pg_json(hash)</pre>
            
            <p>If you have loaded the <a
            href="../../../doc/core_extensions_rdoc.html">core_extensions extension</a>
            or you have loaded the core_refinements extension and have activated
            refinements for the file, you can also use <a
            href="../../../../classes/Array.html#method-i-pg_json">Array#pg_json</a>
            and <a
            href="../../../../classes/Hash.html#method-i-pg_json">Hash#pg_json</a>:</p>
            
            <pre>array.pg_json&#x000A;hash.pg_json</pre>
            
            <p>So if you want to insert an array or hash into an json database column:</p>
            
            <pre class="ruby"><span class="ruby-constant">DB</span>[:<span class="ruby-identifier">table</span>].<span class="ruby-identifier">insert</span>(:<span class="ruby-identifier">column=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">pg_json</span>([<span class="ruby-value">1</span>, <span class="ruby-value">2</span>, <span class="ruby-value">3</span>]))&#x000A;<span class="ruby-constant">DB</span>[:<span class="ruby-identifier">table</span>].<span class="ruby-identifier">insert</span>(:<span class="ruby-identifier">column=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">pg_json</span>({<span class="ruby-string">'a'</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>, <span class="ruby-string">'b'</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">2</span>}))</pre>
            
            <p>If you would like to use PostgreSQL json columns in your model objects, you
            probably want to modify the schema parsing/typecasting so that it
            recognizes and correctly handles the json type, which you can do by:</p>
            
            <pre>DB.extension :pg_json</pre>
            
            <p>If you are not using the native postgres adapter and are using json types
            as model column values you probably should use the pg_typecast_on_load
            plugin if the column values are returned as a string.</p>
            
            <p>This extension integrates with the pg_array extension.  If you plan to use
            the json[] type, load the pg_array extension before the pg_json extension:</p>
            
            <pre>DB.extension :pg_array, :pg_json</pre>
            
            <p>This extension requires both the json and delegate libraries.</p>
          </div>
          <div id='context'>
            <div id='requires'>
              <h2>Required files</h2>
              <ol>
                <li>delegate</li>
                <li>json</li>
                <li>adapters/utils/pg_types</li>
              </ol>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a target="docwin" href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
