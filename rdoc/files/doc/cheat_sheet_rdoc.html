<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>cheat_sheet.rdoc</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='file' id='wrapper'>
      <div class='header'>
        <h1 class='name'>cheat_sheet.rdoc</h1>
        <div class='paths'>
          doc/cheat_sheet.rdoc
        </div>
        <div class='last-update'>
          Last Update:
          <span class='datetime'>2013-11-08 08:08:17 -0500</span>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            
            <h1 id="label-Cheat+Sheet+++">Cheat Sheet   </h1>
            
            <h2 id="label-Open+a+database">Open a database</h2>
            
            <pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">'sequel'</span>&#x000A;&#x000A;<span class="ruby-constant">DB</span> = <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">sqlite</span>(<span class="ruby-string">'my_blog.db'</span>)&#x000A;<span class="ruby-constant">DB</span> = <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">connect</span>(<span class="ruby-string">'postgres://user:password@localhost/my_db'</span>)&#x000A;<span class="ruby-constant">DB</span> = <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">postgres</span>(<span class="ruby-string">'my_db'</span>, :<span class="ruby-identifier">user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'user'</span>, :<span class="ruby-identifier">password</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'password'</span>, :<span class="ruby-identifier">host</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'localhost'</span>)&#x000A;<span class="ruby-constant">DB</span> = <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">ado</span>(<span class="ruby-string">'mydb'</span>)</pre>
            
            <h2 id="label-Open+an+SQLite+memory+database">Open an SQLite memory database</h2>
            
            <p>Without a filename argument, the sqlite adapter will setup a new sqlite
            database in memory.</p>
            
            <pre>DB = Sequel.sqlite</pre>
            
            <h2 id="label-Logging+SQL+statements">Logging SQL statements</h2>
            
            <pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">'logger'</span>&#x000A;<span class="ruby-constant">DB</span> = <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">sqlite</span> <span class="ruby-string">''</span>, :<span class="ruby-identifier">loggers</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-constant">Logger</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">$stdout</span>)]&#x000A;<span class="ruby-comment"># or</span>&#x000A;<span class="ruby-constant">DB</span>.<span class="ruby-identifier">loggers</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Logger</span>.<span class="ruby-identifier">new</span>(<span class="ruby-operator">...</span>)</pre>
            
            <h2 id="label-Using+raw+SQL">Using raw SQL</h2>
            
            <pre class="ruby"><span class="ruby-constant">DB</span>.<span class="ruby-identifier">run</span> <span class="ruby-string">&quot;CREATE TABLE users (name VARCHAR(255) NOT NULL, age INT(3) NOT NULL)&quot;</span>&#x000A;<span class="ruby-identifier">dataset</span> = <span class="ruby-constant">DB</span>[<span class="ruby-string">&quot;SELECT age FROM users WHERE name = ?&quot;</span>, <span class="ruby-identifier">name</span>]&#x000A;<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">map</span>(:<span class="ruby-identifier">age</span>)&#x000A;<span class="ruby-constant">DB</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&quot;SELECT name FROM users&quot;</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>&#x000A;  <span class="ruby-identifier">p</span> <span class="ruby-identifier">row</span>[:<span class="ruby-identifier">name</span>]&#x000A;<span class="ruby-keyword">end</span></pre>
            
            <h2 id="label-Create+a+dataset">Create a dataset</h2>
            
            <pre>dataset = DB[:items]&#x000A;dataset = DB.from(:items)</pre>
            
            <h2 id="label-Most+dataset+methods+are+chainable">Most dataset methods are chainable</h2>
            
            <pre class="ruby"><span class="ruby-identifier">dataset</span> = <span class="ruby-constant">DB</span>[:<span class="ruby-identifier">managers</span>].<span class="ruby-identifier">where</span>(:<span class="ruby-identifier">salary</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">5000</span><span class="ruby-operator">..</span><span class="ruby-value">10000</span>).<span class="ruby-identifier">order</span>(:<span class="ruby-identifier">name</span>, :<span class="ruby-identifier">department</span>)</pre>
            
            <h2 id="label-Insert+rows">Insert rows</h2>
            
            <pre class="ruby"><span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">insert</span>(:<span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Sharon'</span>, :<span class="ruby-identifier">grade</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">50</span>)</pre>
            
            <h2 id="label-Retrieve+rows">Retrieve rows</h2>
            
            <pre class="ruby"><span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">p</span> <span class="ruby-identifier">r</span>}&#x000A;<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">all</span> <span class="ruby-comment"># =&gt; [{...}, {...}, ...]</span>&#x000A;<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">first</span> <span class="ruby-comment"># =&gt; {...}</span></pre>
            
            <h2 id="label-Update%2FDelete+rows">Update/Delete rows</h2>
            
            <pre class="ruby"><span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">exclude</span>(:<span class="ruby-identifier">active</span>).<span class="ruby-identifier">delete</span>&#x000A;<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">'price &lt; ?'</span>, <span class="ruby-value">100</span>).<span class="ruby-identifier">update</span>(:<span class="ruby-identifier">active</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>)</pre>
            
            <h2 id="label-Datasets+are+Enumerable">Datasets are Enumerable</h2>
            
            <pre class="ruby"><span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>[:<span class="ruby-identifier">name</span>]}&#x000A;<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">map</span>(:<span class="ruby-identifier">name</span>) <span class="ruby-comment"># same as above</span>&#x000A;&#x000A;<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">inject</span>(<span class="ruby-value">0</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">sum</span>, <span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">sum</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r</span>[:<span class="ruby-identifier">value</span>]}&#x000A;<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">sum</span>(:<span class="ruby-identifier">value</span>) <span class="ruby-comment"># better</span></pre>
            
            <h2 id="label-Filtering+%28see+also+Dataset+Filtering%29">Filtering (see also <a href="dataset_filtering_rdoc.html">Dataset Filtering</a></h2>
            
            <h3 id="label-Equality">Equality</h3>
            
            <pre class="ruby"><span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">where</span>(:<span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'abc'</span>)&#x000A;<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">'name = ?'</span>, <span class="ruby-string">'abc'</span>)</pre>
            
            <h3 id="label-Inequality">Inequality</h3>
            
            <pre>dataset.where{value &gt; 100}&#x000A;dataset.exclude{value &lt;= 100}</pre>
            
            <h3 id="label-Inclusion">Inclusion</h3>
            
            <pre class="ruby"><span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">where</span>(:<span class="ruby-identifier">value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">50</span><span class="ruby-operator">..</span><span class="ruby-value">100</span>)&#x000A;<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">where</span>{(<span class="ruby-identifier">value</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">50</span>) &amp; (<span class="ruby-identifier">value</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">100</span>)}&#x000A;&#x000A;<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">'value IN ?'</span>, [<span class="ruby-value">50</span>,<span class="ruby-value">75</span>,<span class="ruby-value">100</span>])&#x000A;<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">where</span>(:<span class="ruby-identifier">value=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value">50</span>,<span class="ruby-value">75</span>,<span class="ruby-value">100</span>])&#x000A;&#x000A;<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">where</span>(:<span class="ruby-identifier">id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">other_dataset</span>.<span class="ruby-identifier">select</span>(:<span class="ruby-identifier">other_id</span>))</pre>
            
            <h3 id="label-Subselects+as+scalar+values">Subselects as scalar values</h3>
            
            <pre>dataset.where('price &gt; (SELECT avg(price) + 100 FROM table)')&#x000A;dataset.where{price &gt; dataset.select(avg(price) + 100)}</pre>
            
            <h3 id="label-LIKE%2FRegexp">LIKE/Regexp</h3>
            
            <pre class="ruby"><span class="ruby-constant">DB</span>[:<span class="ruby-identifier">items</span>].<span class="ruby-identifier">where</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">like</span>(:<span class="ruby-identifier">name</span>, <span class="ruby-string">'AL%'</span>))&#x000A;<span class="ruby-constant">DB</span>[:<span class="ruby-identifier">items</span>].<span class="ruby-identifier">where</span>(:<span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-regexp">/^AL/</span>)</pre>
            
            <h3 id="label-AND%2FOR%2FNOT">AND/OR/NOT</h3>
            
            <pre class="ruby"><span class="ruby-constant">DB</span>[:<span class="ruby-identifier">items</span>].<span class="ruby-identifier">where</span>{(<span class="ruby-identifier">x</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">5</span>) &amp; (<span class="ruby-identifier">y</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">10</span>)}.<span class="ruby-identifier">sql</span> &#x000A;<span class="ruby-comment"># SELECT * FROM items WHERE ((x &gt; 5) AND (y &gt; 10))</span>&#x000A;&#x000A;<span class="ruby-constant">DB</span>[:<span class="ruby-identifier">items</span>].<span class="ruby-identifier">where</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">or</span>(:<span class="ruby-identifier">x</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, :<span class="ruby-identifier">y</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>)) &amp; <span class="ruby-constant">Sequel</span>.<span class="ruby-operator">~</span>(:<span class="ruby-identifier">z</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">3</span>)).<span class="ruby-identifier">sql</span> &#x000A;<span class="ruby-comment"># SELECT * FROM items WHERE (((x = 1) OR (y = 2)) AND (z != 3))</span></pre>
            
            <h3 id="label-Mathematical+operators">Mathematical operators</h3>
            
            <pre>DB[:items].where{x + y &gt; z}.sql &#x000A;# SELECT * FROM items WHERE ((x + y) &gt; z)&#x000A;DB[:items].where{price - 100 &lt; avg(price)}.sql &#x000A;# SELECT * FROM items WHERE ((price - 100) &lt; avg(price))</pre>
            
            <h2 id="label-Ordering">Ordering</h2>
            
            <pre>dataset.order(:kind)&#x000A;dataset.reverse_order(:kind)&#x000A;dataset.order(Sequel.desc(:kind), :name)</pre>
            
            <h2 id="label-Limit%2FOffset">Limit/Offset</h2>
            
            <pre>dataset.limit(30) # LIMIT 30&#x000A;dataset.limit(30, 10) # LIMIT 30 OFFSET 10&#x000A;dataset.limit(30).offset(10) # LIMIT 30 OFFSET 10</pre>
            
            <h2 id="label-Joins">Joins</h2>
            
            <pre class="ruby"><span class="ruby-constant">DB</span>[:<span class="ruby-identifier">items</span>].<span class="ruby-identifier">left_outer_join</span>(:<span class="ruby-identifier">categories</span>, :<span class="ruby-identifier">id</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">category_id</span>).<span class="ruby-identifier">sql</span> &#x000A;<span class="ruby-comment"># SELECT * FROM items</span>&#x000A;<span class="ruby-comment"># LEFT OUTER JOIN categories ON categories.id = items.category_id</span>&#x000A;&#x000A;<span class="ruby-constant">DB</span>[:<span class="ruby-identifier">items</span>].<span class="ruby-identifier">join</span>(:<span class="ruby-identifier">categories</span>, :<span class="ruby-identifier">id</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">category_id</span>).<span class="ruby-identifier">join</span>(:<span class="ruby-identifier">groups</span>, :<span class="ruby-identifier">id</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">items__group_id</span>) &#x000A;<span class="ruby-comment"># SELECT * FROM items</span>&#x000A;<span class="ruby-comment"># INNER JOIN categories ON categories.id = items.category_id</span>&#x000A;<span class="ruby-comment"># INNER JOIN groups ON groups.id = items.group_id</span></pre>
            
            <h2 id="label-Aggregate+functions+methods">Aggregate functions methods</h2>
            
            <pre class="ruby"><span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">count</span> <span class="ruby-comment">#=&gt; record count</span>&#x000A;<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">max</span>(:<span class="ruby-identifier">price</span>)&#x000A;<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">min</span>(:<span class="ruby-identifier">price</span>)&#x000A;<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">avg</span>(:<span class="ruby-identifier">price</span>)&#x000A;<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">sum</span>(:<span class="ruby-identifier">stock</span>)&#x000A;&#x000A;<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">group_and_count</span>(:<span class="ruby-identifier">category</span>)&#x000A;<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">select_group</span>(:<span class="ruby-identifier">category</span>).<span class="ruby-identifier">select_append</span>{<span class="ruby-identifier">avg</span>(:<span class="ruby-identifier">price</span>)}</pre>
            
            <h2 id="label-SQL+Functions+%2F+Literals">SQL Functions / Literals</h2>
            
            <pre class="ruby"><span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">update</span>(:<span class="ruby-identifier">updated_at</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">function</span>(:<span class="ruby-constant">NOW</span>))&#x000A;<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">update</span>(:<span class="ruby-identifier">updated_at</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">lit</span>(<span class="ruby-string">'NOW()'</span>))&#x000A;&#x000A;<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">update</span>(:<span class="ruby-identifier">updated_at</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">lit</span>(<span class="ruby-string">&quot;DateValue('1/1/2001')&quot;</span>)&#x000A;<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">update</span>(:<span class="ruby-identifier">updated_at</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">function</span>(:<span class="ruby-constant">DateValue</span>, <span class="ruby-string">'1/1/2001'</span>))</pre>
            
            <h2 id="label-Schema+Manipulation">Schema Manipulation</h2>
            
            <pre class="ruby"><span class="ruby-constant">DB</span>.<span class="ruby-identifier">create_table</span> :<span class="ruby-identifier">items</span> <span class="ruby-keyword">do</span>&#x000A;  <span class="ruby-identifier">primary_key</span> :<span class="ruby-identifier">id</span>&#x000A;  <span class="ruby-constant">String</span> :<span class="ruby-identifier">name</span>, :<span class="ruby-identifier">unique</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, :<span class="ruby-identifier">null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>&#x000A;  <span class="ruby-constant">TrueClass</span> :<span class="ruby-identifier">active</span>, :<span class="ruby-identifier">default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>&#x000A;  <span class="ruby-identifier">foreign_key</span> :<span class="ruby-identifier">category_id</span>, :<span class="ruby-identifier">categories</span>&#x000A;  <span class="ruby-constant">DateTime</span> :<span class="ruby-identifier">created_at</span>&#x000A;&#x000A;  <span class="ruby-identifier">index</span> :<span class="ruby-identifier">created_at</span>&#x000A;<span class="ruby-keyword">end</span>&#x000A;&#x000A;<span class="ruby-constant">DB</span>.<span class="ruby-identifier">drop_table</span> :<span class="ruby-identifier">items</span></pre>
            
            <h2 id="label-Aliasing">Aliasing</h2>
            
            <pre>DB[:items].select(Sequel.as(:name, :item_name))&#x000A;DB[:items].select(:name___item_name)&#x000A;DB[:items___items_table].select(:items_table__name___item_name)&#x000A;# SELECT items_table.name AS item_name FROM items AS items_table</pre>
            
            <h2 id="label-Transactions">Transactions</h2>
            
            <pre class="ruby"><span class="ruby-constant">DB</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword">do</span>&#x000A;  <span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">insert</span>(:<span class="ruby-identifier">first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Inigo'</span>, :<span class="ruby-identifier">last_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Montoya'</span>)&#x000A;  <span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">insert</span>(:<span class="ruby-identifier">first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Farm'</span>, :<span class="ruby-identifier">last_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Boy'</span>)&#x000A;<span class="ruby-keyword">end</span> <span class="ruby-comment"># Either both are inserted or neither are inserted</span></pre>
            
            <p>Database#transaction is re-entrant:</p>
            
            <pre class="ruby"><span class="ruby-constant">DB</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword">do</span> <span class="ruby-comment"># BEGIN issued only here</span>&#x000A;  <span class="ruby-constant">DB</span>.<span class="ruby-identifier">transaction</span>&#x000A;    <span class="ruby-identifier">dataset</span> <span class="ruby-operator">&lt;&lt;</span> {:<span class="ruby-identifier">first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Inigo'</span>, :<span class="ruby-identifier">last_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Montoya'</span>}&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span> <span class="ruby-comment"># COMMIT issued only here</span></pre>
            
            <p>Transactions are aborted if an error is raised:</p>
            
            <pre>DB.transaction do&#x000A;  raise &quot;some error occurred&quot;&#x000A;end # ROLLBACK issued and the error is re-raised</pre>
            
            <p>Transactions can also be aborted by raising Sequel::Rollback:</p>
            
            <pre>DB.transaction do&#x000A;  raise(Sequel::Rollback) if something_bad_happened&#x000A;end # ROLLBACK issued and no error raised</pre>
            
            <p>Savepoints can be used if the database supports it:</p>
            
            <pre class="ruby"><span class="ruby-constant">DB</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword">do</span>&#x000A;  <span class="ruby-identifier">dataset</span> <span class="ruby-operator">&lt;&lt;</span> {:<span class="ruby-identifier">first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Farm'</span>, :<span class="ruby-identifier">last_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Boy'</span>} <span class="ruby-comment"># Inserted</span>&#x000A;  <span class="ruby-constant">DB</span>.<span class="ruby-identifier">transaction</span>(:<span class="ruby-identifier">savepoint=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">true</span>) <span class="ruby-comment"># This savepoint is rolled back</span>&#x000A;    <span class="ruby-identifier">dataset</span> <span class="ruby-operator">&lt;&lt;</span> {:<span class="ruby-identifier">first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Inigo'</span>, :<span class="ruby-identifier">last_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Montoya'</span>} <span class="ruby-comment"># Not inserted</span>&#x000A;    <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">something_bad_happened</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-identifier">dataset</span> <span class="ruby-operator">&lt;&lt;</span> {:<span class="ruby-identifier">first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Prince'</span>, :<span class="ruby-identifier">last_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Humperdink'</span>} <span class="ruby-comment"># Inserted</span>&#x000A;<span class="ruby-keyword">end</span></pre>
            
            <h2 id="label-Miscellaneous%3A">Miscellaneous:</h2>
            
            <pre class="ruby"><span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">sql</span> <span class="ruby-comment"># &quot;SELECT * FROM items&quot;</span>&#x000A;<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">delete_sql</span> <span class="ruby-comment"># &quot;DELETE FROM items&quot;</span>&#x000A;<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">where</span>(:<span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'sequel'</span>).<span class="ruby-identifier">exists</span> <span class="ruby-comment"># &quot;EXISTS ( SELECT * FROM items WHERE name = 'sequel' )&quot;</span>&#x000A;<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">columns</span> <span class="ruby-comment">#=&gt; array of columns in the result set, does a SELECT</span>&#x000A;<span class="ruby-constant">DB</span>.<span class="ruby-identifier">schema</span>(:<span class="ruby-identifier">items</span>) =<span class="ruby-operator">&gt;</span> [[:<span class="ruby-identifier">id</span>, {:<span class="ruby-identifier">type=</span><span class="ruby-operator">&gt;</span>:<span class="ruby-identifier">integer</span>, <span class="ruby-operator">...</span>}], [:<span class="ruby-identifier">name</span>, {:<span class="ruby-identifier">type=</span><span class="ruby-operator">&gt;</span>:<span class="ruby-identifier">string</span>, <span class="ruby-operator">...</span>}], <span class="ruby-operator">...</span>]</pre>
          </div>
          <div id='context'>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a target="docwin" href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
